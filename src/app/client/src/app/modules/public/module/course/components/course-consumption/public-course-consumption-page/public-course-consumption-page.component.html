<mat-toolbar color="primary" class="toolbar-pageback">
  <button mat-mini-fab color="accent" (click)="redirectToExplore()" attr.aria-label="{{resourceService?.frmelmnts?.btn?.back}}" tabindex="0">
    <mat-icon>arrow_back</mat-icon>
  </button>
    <div class="toolbar-pageback__img" *ngIf="!showLoader && !showError">
      <img src="{{courseHierarchy?.appIcon || 'assets/images/book.png'}}" alt="{{courseHierarchy?.name}}"
        class="thumbnail">
    </div>
    <div class="toolbar-pageback__heading" *ngIf="!showLoader && !showError">
      <h3 class="mat-title mb-0 sb__ellipsis" tabindex="0" role="heading" aria-level="2">{{courseHierarchy?.name}}</h3>
      <div class="toolbar-pageback__metadata">
        <sui-rating class="ui star rating" [isReadonly]="true" [ngModel]="courseHierarchy.me_averageRating || 0"
        [maximum]="5"></sui-rating>
      <button mat-button tabindex="0" (click)="onShareLink()" class="ml-8"><mat-icon class="mr-8">share</mat-icon>
        {{resourceService?.frmelmnts?.lbl?.share}}</button>
      </div>
    </div>

  <div *ngIf="!showLoader && !showError" class="toolbar-pageback__action ml-auto">
    <div *ngIf="isValidEnrollmentEndDate(enrollmentEndDate)">
      <span class="mat-caption"
        *ngIf="!isEnrollmentAllowed(enrollmentEndDate)">{{resourceService?.messages?.stmsg?.m0136}}
        {{enrollmentEndDate | dateFormat}}</span>
      <span class="sb-label-status-error"
        *ngIf="isEnrollmentAllowed(enrollmentEndDate)">{{resourceService?.messages?.emsg?.m008 |
        interpolate:'{endDate}':enrollmentEndDate}}</span>
    </div>
    <div class="d-flex" [ngClass]="{'d-flex': isDesktopApp}">
      <button *ngIf="!enrolledCourse && !courseMentor" mat-raised-button tabindex="0" class="button-rounded"
        [color]="isEnrollmentAllowed(enrollmentEndDate) ? '' : 'success'"
        [disabled]="isEnrollmentAllowed(enrollmentEndDate)"
        (click)="showJoinModal(true); logTelemetry(courseHierarchy?.primaryCategory.toLowerCase() === 'course' ? 'join-course' : 'join', courseHierarchy);">{{generaliseLabelService?.frmelmnts?.btn?.enroll}}</button>
      <span *ngIf="isDesktopApp && !enrolledCourse && !courseMentor">
        <button mat-button type="button" class="ml-8 button-rounded"
          *ngIf="isConnected && (checkStatus('DOWNLOADED')) && showUpdate" tabindex="0"
          (click)="updateCollection(courseHierarchy)">{{resourceService?.frmelmnts?.btn?.update}}</button>
        <button mat-button type="button" class="ml-8 button-rounded" *ngIf="checkStatus('DOWNLOADED')"
          [disabled]="disableDelete" tabindex="0"
          (click)="logTelemetry('confirm-delete-collection'); showDeleteModal = !showDeleteModal;">{{resourceService?.frmelmnts?.btn?.delete}}</button>
        <button mat-button type="button" class="ml-8 button-rounded" *ngIf="checkStatus('DOWNLOADED')" tabindex="0"
          (click)="exportCollection(courseHierarchy)">{{resourceService?.frmelmnts?.lbl?.saveToPenDrive}}</button>
        <button mat-button type="button" class="ml-8 button-rounded" *ngIf="checkStatus('DOWNLOAD')" appOnlineOnly
          tabindex="0"
          (click)="isYoutubeContentPresent(courseHierarchy)">{{resourceService?.frmelmnts?.btn?.download}}</button>
        <button mat-button type="button" class="ml-8 button-rounded"
          *ngIf="checkStatus('DOWNLOADING')">{{resourceService?.frmelmnts?.lbl?.downloading}}</button>
        <button mat-button type="button" class="ml-8 button-rounded"
          *ngIf="checkStatus('PAUSED')">{{resourceService.frmelmnts?.lbl?.downloadingPaused}}</button>
      </span>
    </div>
  </div>
</mat-toolbar>

<div [ngClass]="layoutConfiguration ? 'mat-inside-page-container mat-app-background2 public-course-consumption-page' : 'pt-16'">
  <router-outlet *ngIf="!showLoader && !showError"></router-outlet>
  <span *ngIf="showLoader">
    <app-loader></app-loader>
  </span>
</div>

<app-modal-wrapper *ngIf="sharelinkModal" [config]="{disableClose: false, size: 'normal', panelClass: 'material-modal'}"
  (dismiss)="closeSharePopup('close-share-link-popup')">
  <ng-template sbModalContent>
    <app-share-link [shareLink]="shareLink" [telemetryShareData]="telemetryShareData">
    </app-share-link>
  </ng-template>
</app-modal-wrapper>

<div>

  <app-modal-wrapper *ngIf="showModal" [config]="{disableClose: true, size: 'normal'}"
    (dismiss)="showModal = !showModal;" #modal>
    <ng-template sbModalContent>
      <h2 mat-dialog-title>{{resourceService.frmelmnts?.btn?.download}}</h2>
      <mat-dialog-content>
        <p>{{resourceService?.messages?.stmsg?.m0137}}</p>
      </mat-dialog-content>
      <mat-dialog-actions align="end">
        <button mat-button class="button-rounded" tabindex="0"
          (click)="downloadCollection(courseHierarchy); showModal = !showModal;">
          {{resourceService.frmelmnts?.btn?.download}}
        </button>
        <button mat-button class="button-rounded" tabindex="0"
          (click)="logTelemetry('cancel-download-collection'); showModal = !showModal;">
          {{resourceService.frmelmnts?.btn?.cancel}}
        </button>
      </mat-dialog-actions>
    </ng-template>
  </app-modal-wrapper>

  <app-modal-wrapper *ngIf="showDeleteModal" [config]="{disableClose: true, size: 'normal'}"
    (dismiss)="showDeleteModal = !showDeleteModal;" #modal>
    <ng-template sbModalContent>
      <h2 mat-dialog-title>{{resourceService?.frmelmnts?.lbl?.delete}}</h2>
      <mat-dialog-content>
        <p>{{resourceService?.frmelmnts?.lbl?.desktop?.deleteCourse | interpolate:'{name}': courseHierarchy?.name}}</p>
      </mat-dialog-content>
      <mat-dialog-actions align="end">
        <button mat-button class="button-rounded" tabindex="0"
          (click)="deleteCollection(courseHierarchy); showDeleteModal = !showDeleteModal;">
          {{resourceService?.frmelmnts?.lbl?.delete}}
        </button>
        <button mat-button class="button-rounded" tabindex="0"
          (click)="logTelemetry('cancel-delete-collection'); showDeleteModal = !showDeleteModal;">
          {{resourceService.frmelmnts?.btn?.cancel}}
        </button>
      </mat-dialog-actions>
    </ng-template>
  </app-modal-wrapper>
</div>