<div *ngIf="collectionData" [style.display]="!showLoader ? 'block' : 'none'"
  [appTelemetryImpression]="telemetryContentImpression">

  <!--CC-Player Back button -->
  <mat-toolbar color="primary" class="toolbar-pageback">
    <div class="d-flex flex-ai-center w-50">
      <button type="button" mat-mini-fab color="accent"
        class="button-rounded" tabindex="0" (click)="closeCollectionPlayer()"
        attr.aria-label="{{resourceService?.frmelmnts?.btn?.back}}">
        <mat-icon aria-hidden="false" aria-label="Back icon" fontIcon="arrow_back"></mat-icon>
      </button>
      <div class="toolbar-pageback__heading" *ngIf="collectionData">
        <h3 class="mat-title mb-0 ellipsis" tabindex="0" role="heading" aria-level="2">{{collectionData.name}}</h3>
          <div class="toolbar-pageback__metadata">
            <div class="sub-title mat-body-1 mt-4" *ngIf="collectionTreeNodes">
              <span *ngIf="collectionTreeNodes?.data?.board">{{collectionTreeNodes?.data?.board}}</span>
              <span class="dot-divider" *ngIf="collectionTreeNodes?.data?.medium"></span>
              <span *ngIf="collectionTreeNodes?.data?.medium">{{collectionTreeNodes?.data?.medium}}</span>
              <span class="dot-divider" *ngIf="collectionTreeNodes?.data?.gradeLevel"></span>
              <span *ngIf="collectionTreeNodes?.data?.gradeLevel">{{collectionTreeNodes?.data?.gradeLevel}}</span>
            </div>
          </div>
      </div>
    </div>
    <div class="toolbar-pageback__actions" *ngIf="collectionData">
      <div *ngIf="isDesktopApp">
        <button type="button" mat-raised-button class="button-rounded mr-8"
          *ngIf="isConnected && (checkStatus('DOWNLOADED')) && showUpdate" tabindex="0"
          (click)="updateCollection(collectionData)">{{resourceService?.frmelmnts?.lbl?.desktop?.updateTextbook}}</button>
        <button type="button" mat-raised-button class="button-rounded mr-8"
          *ngIf="checkStatus('DOWNLOADED')" [disabled]="disableDelete" tabindex="0"
          (click)="logTelemetry('confirm-delete-collection'); showDeleteModal = !showDeleteModal;">{{resourceService?.frmelmnts?.lbl?.desktop?.deleteBook}}</button>
        <button type="button" mat-raised-button class="button-rounded mr-8"
          *ngIf="checkStatus('DOWNLOADED')" tabindex="0"
          (click)="exportCollection(collectionData)">{{resourceService?.frmelmnts?.lbl?.saveToPenDrive}}</button>
        <button type="button" mat-raised-button class="button-rounded mr-8"
          *ngIf="checkStatus('DOWNLOAD')" tabindex="0"
          (click)="isYoutubeContentPresent(collectionData)">{{resourceService?.frmelmnts?.lbl?.desktop?.downloadBook}}</button>
        <button type="button" mat-raised-button class="button-rounded mr-8"
          *ngIf="checkStatus('DOWNLOADING')">{{resourceService?.frmelmnts?.lbl?.downloading}}</button>
        <button type="button" mat-raised-button class="button-rounded mr-8"
          *ngIf="checkStatus('PAUSED')">{{resourceService.frmelmnts?.lbl?.downloadingPaused}}</button>
      </div>

      <button type="button" *ngIf="!isCopyAsCourseClicked" tabindex="0" (click)="onShareLink();sharelinkModal=true;"
      mat-raised-button class="button-rounded mr-8">
      <mat-icon aria-hidden="false" aria-label="{{resourceService?.frmelmnts?.lbl?.share}}" fontIcon="share"></mat-icon> {{resourceService?.frmelmnts?.lbl?.share}}
      </button>

      <button type="button" appTelemetryInteract [telemetryInteractObject]="collectionInteractObject"
        [telemetryInteractEdata]="copyContentInteractEdata"
        *ngIf="!isDesktopApp && permissionService.permissionAvailable && collectionTreeNodes.data.contentType !== 'TextBook' && !isCopyAsCourseClicked"
        appPermission [permission]="['CONTENT_CREATOR', 'CONTENT_REVIEWER']" tabindex="0"
        (click)="copyContent(collectionTreeNodes.data)" mat-raised-button class="button-rounded mr-8">
        <mat-icon aria-hidden="false" aria-label="{{resourceService?.frmelmnts?.lbl?.share}}" fontIcon="content_copy"></mat-icon>{{resourceService?.frmelmnts?.lbl?.copy}}
      </button>

      <button type="button" appTelemetryInteract [telemetryInteractObject]="collectionInteractObject"
        [telemetryInteractEdata]="copyContentInteractEdata"
        *ngIf="!isDesktopApp && permissionService.permissionAvailable && collectionTreeNodes.data.contentType === 'TextBook' && !isCopyAsCourseClicked"
        appPermission [permission]="['BOOK_CREATOR']" tabindex="0" (click)="copyContent(collectionTreeNodes.data)"
        mat-raised-button class="button-rounded mr-8">
        <mat-icon aria-hidden="false" aria-label="{{resourceService?.frmelmnts?.lbl?.share}}" fontIcon="content_copy"></mat-icon> {{resourceService?.frmelmnts?.lbl?.copy}}
      </button>

      <button type="button" appTelemetryInteract [telemetryInteractObject]="collectionInteractObject"
        [telemetryInteractEdata]="copyAsCourseInteractEdata" href="javascript:void(0)"
        *ngIf="!isDesktopApp && permissionService.permissionAvailable && collectionTreeNodes.data.contentType === 'TextBook' && !isCopyAsCourseClicked"
        appPermission [permission]="['CONTENT_CREATOR']" tabindex="0" (click)="copyAsCourse()"
        mat-raised-button class="button-rounded mr-8">
        <img src="assets/images/copy-clone.svg" alt="copy-clone" class="mr-4 pt-2">
        {{resourceService?.frmelmnts?.lbl?.copyAsCourse}}
      </button>

      <button type="button" appTelemetryInteract [telemetryInteractObject]="collectionInteractObject"
        [telemetryInteractEdata]="cancelInteractEdata" href="javascript:void(0)"
        *ngIf="!isDesktopApp && permissionService.permissionAvailable && collectionTreeNodes.data.contentType === 'TextBook' && isCopyAsCourseClicked"
        appPermission [permission]="['CONTENT_CREATOR']" tabindex="0" (click)="clearSelection()"
        mat-raised-button class="button-rounded mr-8">
        {{resourceService?.frmelmnts?.btn?.cancel}}
      </button>

      <button
        [disabled]="!(selectedItems.length > 0)" type="button" appTelemetryInteract
        [telemetryInteractObject]="collectionInteractObject" [telemetryInteractEdata]="createCourseInteractEdata"
        href="javascript:void(0)"
        *ngIf="!isDesktopApp && permissionService.permissionAvailable && collectionTreeNodes.data.contentType === 'TextBook' && isCopyAsCourseClicked"
        appPermission [permission]="['CONTENT_CREATOR']" tabindex="0" (click)="createCourse()"
        mat-raised-button class="button-rounded mr-8">
        {{generaliseLabelService?.frmelmnts?.btn?.create}}
      </button>

      <span *ngIf="isGroupAdmin">
        <button mat-raised-button class="button-rounded ml-auto" appAddToGroup
          [identifier]="collectionData?.identifier"
          [pageId]="collectionData?.primaryCategory?.toLowerCase()">{{resourceService?.frmelmnts?.lbl?.AddtoGroup}}
        </button>
      </span>

      <div class="" *ngIf="!isDesktopApp && showCopyLoader">
        <div class="mt-40">
          {{resourceService.frmelmnts.lbl.copycontent}}
        </div>
      </div>
    </div>
  </mat-toolbar>


  <div class="mat-inside-page-container mat-app-background2" [appTelemetryStart]="telemetryCourseStart"
    [appTelemetryEnd]="telemetryCourseEndEvent">

    <!-- CC-Player Video -->
    <div>
      <div class="cc-player sb-g">
        <section class="sb-g-col-xs-12 sb-g-col-md-8 sb-g-col-lg-8 sb-g-col-xxxl-12"
          [appTelemetryImpression]="telemetryImpression" *ngIf="collectionData">
          <app-contentplayer-page [playerConfig]="playerConfig | async" [tocPage]="true"
            [contentDetails]="activeContent" [collectionData]="collectionData" [isContentPresent]="isContentPresent"
            [objectRollUp]="objectRollUp">
          </app-contentplayer-page>
        </section>
        <section class="sb-g-col-xs-12 sb-g-col-md-4 sb-g-col-lg-4 sb-g-col-xxxl-4 cc-player__list mb-16"
          *ngIf="collectionData">
          <!-- This checkbox needs to be converted to Angular material -->
          <div class="toc-box-shadow mb-2" *ngIf="isCopyAsCourseClicked">
            <div class="sbselectpopover sbselectpopover--bg-white d-flex flex-ai-center p-16">
              <h6 class="color_accent mat-body-1 mb-0 font-weight-normal">
                {{generaliseLabelService?.frmelmnts?.lbl?.selectContentFromCourse}}</h6>
              <div class="sb-checkbox sb-checkbox-rightaligned sb-checkbox-primary ml-auto m-0">
                <input tabindex="0" (click)="selectAllItem()" type="checkbox" id="checkbox" name="example">
                <label class="mb-0 mr-0 sb-color-primary" for="checkbox">
                  {{resourceService?.frmelmnts?.lbl?.selectAll}}</label>
              </div>
            </div>
          </div>
          <div>
            <sb-library-filters [hidden]="isSelectChapter" [tocList]="mimeTypeFilters" [layout]="'round-with-icon'"
              (selectedMimeType)="selectedFilter($event)">
            </sb-library-filters>
          </div>

          <div [hidden]="isSelectChapter" class="mt-16">
            <sb-toc-item [selectAll]="selectAll" [selectMode]="isCopyAsCourseClicked"
              [activeMimeTypeFilter]="activeMimeTypeFilter" [tocData]="collectionData"
              [noContentMessage]="noContentMessage" (tocCardClick)="tocCardClickHandler($event)"
              [activeContent]="activeContent" (noContent)="showNoContent($event)"
              (selectedItem)="handleSelectedItem($event)" appTelemetryInteract
              [telemetryInteractEdata]="tocTelemetryInteractEdata" [telemetryInteractCdata]="tocTelemetryInteractCdata"
              [platform]="PlatformType.PORTAL" [type]="TocCardType.TRACKABLE"
              [trackableDefaultImage]="'assets/images/mask-image/courses.svg'"></sb-toc-item>
          </div>
          <div [hidden]="!isSelectChapter">
            <span>
              <app-content-chapterlist [activeContent]="activeContent" [contentDetails]="collectionData"
                (tocChapterClick)="tocChapterClickHandler($event)"></app-content-chapterlist>
            </span>
          </div>
          <div>
            <app-content-licence [content]="collectionData"></app-content-licence>
          </div>
        </section>
      </div>
    </div>

    <div class="py-16" *ngIf="showLoader">
      <app-loader [data]='loaderMessage'></app-loader>
    </div>

  </div>
  <div class="py-16" *ngIf="showLoader">
    <app-loader [data]='loaderMessage'></app-loader>
  </div>
  <app-modal-wrapper *ngIf="sharelinkModal" [config]="{disableClose: false, panelClass: 'material-modal'}" (dismiss)="sharelinkModal = false">
    <ng-template sbModalContent>
      <app-share-link [shareLink]="shareLink" [telemetryShareData]="telemetryShareData">
      </app-share-link>
    </ng-template>
  </app-modal-wrapper>
</div>

<div *ngIf="isDesktopApp">

  <app-modal-wrapper *ngIf="showModal" [config]="{disableClose: true, width: '30rem', panelClass: 'material-modal'}"
    (dismiss)="showModal = !showModal;">
    <ng-template sbModalContent>

      <div mat-dialog-title class="mb-0">
        <h4 class="color-accent font-weight-bold mb-0">{{resourceService.frmelmnts?.btn?.download}}
        </h4>
        <button mat-mini-fab color="warn" class="ml-auto" aria-label="close dialog"
          mat-dialog-close><mat-icon>close</mat-icon></button>
      </div>

      <mat-dialog-content>
        <p>{{resourceService?.messages?.stmsg?.m0137}}</p>
      </mat-dialog-content>
  
      <mat-dialog-actions align="end">
        <button mat-raised-button color="accent" class="button-rounded mr-8" tabindex="0"
          (click)="downloadCollection(collectionData); showModal = !showModal;">
          {{resourceService.frmelmnts?.btn?.download}}
        </button>
        <button mat-raised-button class="button-rounded" tabindex="0"
          (click)="logTelemetry('cancel-download-collection'); showModal = !showModal;">
          {{resourceService.frmelmnts?.btn?.cancel}}
        </button>
      </mat-dialog-actions>
  
    </ng-template>
  </app-modal-wrapper>

  <app-modal-wrapper *ngIf="showDeleteModal" [config]="{disableClose: true, width: '30rem', panelClass: 'material-modal'}"
    (dismiss)="showDeleteModal = !showDeleteModal;">
    <ng-template sbModalContent>
      <div mat-dialog-title class="mb-0">
        <h4 class="color-accent font-weight-bold mb-0">{{resourceService?.frmelmnts?.lbl?.delete}}</h4>
        <button mat-mini-fab color="warn" class="ml-auto" aria-label="close dialog"
          mat-dialog-close><mat-icon>close</mat-icon></button>
      </div>
      <mat-dialog-content>
        <p>{{resourceService?.frmelmnts?.lbl?.desktop?.deleteCollection | interpolate:'{name}':
          collectionData?.name}}
        </p>
      </mat-dialog-content>
  
      <mat-dialog-actions align="end">
        <button mat-raised-button color="accent" class="button-rounded mr-8" tabindex="0"
          (click)="deleteCollection(collectionData); showDeleteModal = !showDeleteModal;">
          {{resourceService?.frmelmnts?.lbl?.delete}}
        </button>
        <button mat-raised-button class="button-rounded" tabindex="0"
          (click)="logTelemetry('cancel-delete-collection'); showDeleteModal = !showDeleteModal;">
          {{resourceService.frmelmnts?.btn?.cancel}}
        </button>
      </mat-dialog-actions>
  
    </ng-template>
  </app-modal-wrapper>

  <app-loader *ngIf="showExportLoader"
    [data]="{loaderMessage: resourceService.frmelmnts?.lbl?.exportingContent | interpolate:'{contentName}':collectionData?.name}">
  </app-loader>
  <app-loader *ngIf="showDownloadLoader"
    [data]="{loaderMessage: resourceService.frmelmnts?.lbl?.downloadingContent | interpolate:'{contentName}':collectionData?.name}">
  </app-loader>
</div>