<div class="graph-filters" #chartRootElement>

  <div class="d-flex pb-10">
    <div class="d-flex flex-dc flex-basis-1 mr-32 min-w-0">
      <label class="mat-body-1 font-weight-bold"> {{ this.chartOptions?.title?.text }} </label>
      <p class="mat-caption font-weight-bold mb-0" *ngIf="showLastUpdatedOn && lastUpdatedOn">
        <span>{{resourceService?.frmelmnts?.lbl?.lastUpdatedOn}}&nbsp;: </span> &nbsp; {{lastUpdatedOn}}
      </p>
    </div>
    <div class="d-flex flex-w-wrap flex-ai-flex-start">


      <div class="d-flex flex-w-wrap reset-filter-section mt-16 mr-8">
        <div *ngIf="showGraphStats" class="d-flex flex-ai-center">{{resourceService?.frmelmnts?.lbl?.graphStat }}:
          <mat-slide-toggle (change)="graphStatsChange($event.checked)" appTelemetryInteract
            [telemetryInteractObject]="telemetryInteractObject"
            [telemetryInteractEdata]="setTelemetryInteractEdata('graph-statistics')"
            [telemetryInteractCdata]="telemetryCdata">
          </mat-slide-toggle>
        </div>
      </div>

      <div class="mr-8" *ngIf="chartType === 'bar' || chartType === 'line'" [ngClass]="{'hide': hideElements}">
        <!-- <button (click)="addChartSummary()" *ngIf="chartConfig.id && isUserReportAdmin" type="button"
          appTelemetryInteract [telemetryInteractObject]="telemetryInteractObject"
          [telemetryInteractCdata]="[{id: chartConfig?.id, type: 'Chart'}]"
          [telemetryInteractEdata]="{id: 'report-chart', type: 'chart-summary', pageid: activatedRoute.snapshot.data.telemetry.pageid}"
          class="mr-8 sb-btn sb-btn-normal sb-btn-link sb-btn-link-primary sb-left-icon-btn"><i class="add icon"></i>Add
          {{ resourceService?.frmelmnts?.lbl?.chartSummary}}</button> -->
          <mat-form-field appearance="fill" color="accent">
            <mat-label>Select ChartType</mat-label>
            <mat-select role="listbox" aria-label="Select ChartType" [(value)]="selectedLanguage" class="selection"
              (selectionChange)="changeChartType($event)">
              <mat-option role="option" *ngFor="let option of availableChartTypeOptions"
                [value]="option" appTelemetryInteract [telemetryInteractObject]="telemetryInteractObject"
                [telemetryInteractEdata]="setTelemetryInteractEdata('chart-type-filter')"
                [telemetryInteractCdata]="telemetryCdata" attr.aria-label="{{option}}">{{option}}</mat-option>
            </mat-select>
          </mat-form-field>
      </div>

      <button *ngIf="isUserReportAdmin && chartConfig.id" [ngClass]="{'hide': hideElements}" appTelemetryInteract
        [telemetryInteractObject]="telemetryInteractObject"
        [telemetryInteractCdata]="[{id: chartConfig?.id, type: 'Chart'}]"
        [telemetryInteractEdata]="{id: 'report-chart', type: 'chart-summary', pageid: activatedRoute.snapshot.data.telemetry.pageid}"
        (click)="addChartSummary()" type="button" tabindex="0"
        mat-raised-button class="button-rounded color-accent mr-8 mt-8"><mat-icon>add</mat-icon>
        {{ chartSummarylabel }}
      </button>



      <button mat-raised-button color="accent" class="button-rounded mt-8" (click)="filterModalPopup(true)" tabindex="0"
        *ngIf="filters?.length > 0" [ngClass]="{'hide': hideElements}">
        {{ resourceService?.frmelmnts?.lbl?.filters }}
      </button>
    </div>
  </div>

  <div class="pt-16 pb-8" *ngIf="currentFilters">
    <div *ngFor="let key of loadash.keys(currentFilters)" class="d-inline-flex flex-w-wrap pr-10">

      <span *ngIf="checkFilterReferance(key)">
        <span class="mb-4">{{key}}:</span>
        <span class="px-8 pt-8 br-24 mat-app-background2" *ngIf="currentFilters[key]?.length>0">
          {{currentFilters[key][0]}} - {{currentFilters[key][currentFilters[key].length-1]}}
        </span>
      </span>
      <span *ngIf="!checkFilterReferance(key)">
        <span class="mb-4">{{key}}:</span><span class="sb-label-value"
          *ngFor="let val of currentFilters[key]">{{val}}
          <!-- <i class="close icon mr-0 pl-4"></i> -->
        </span>
      </span>

    </div>
  </div>

  <div *ngIf="showStats">
    <div _ngcontent-c14="" class="graph-statistics py-16" *ngFor="let stat of loadash.keys(resultStatistics)">
      {{stat}} <div class="px-8 pt-8 mr-4 br-24"
        *ngFor="let op of loadash.keys(resultStatistics[stat])"> {{op}} : {{resultStatistics[stat][op]}}
      </div>
    </div>
  </div>

  <div class="dashboard-graph-statistics py-24" *ngIf="bigNumberCharts.length">
    <div class="graph-stat-block" *ngFor="let bigNumberChart of bigNumberCharts">
      <p class="mat-title mb-8">{{bigNumberChart?.header}}</p>
      <p class="mat-display-1 font-weight-bold mb-8">{{bigNumberChart?.data}} </p>
      <p class="mat-title"> {{bigNumberChart?.footer}} </p>
    </div>
  </div>
  <mat-divider class="my-16"></mat-divider>
  <ng-container *ngIf="showChart && !iframeDetails">
    <canvas #chartCanvas baseChart [datasets]="datasets" [labels]="chartLabels" [options]="chartOptions"
      [chartType]="chartType" [legend]="legend" [colors]="chartColors"></canvas>
  </ng-container>
  <ng-container *ngIf="iframeDetails">
    <iframe frameborder="0" class="dashboard-iframe" [src]="getIframeURL()">
    </iframe>
  </ng-container>
  <div class="my-16" *ngIf="chartSummary$ | async as summary">
    <app-report-summary *ngIf="summary.length" [inputData]="summary"></app-report-summary>
  </div>
</div>

<ng-template #filterPopUpMat>
  <!--Header-->
  <div mat-dialog-title class="mb-0">
    <h2 class="mb-0">{{ resourceService?.frmelmnts?.lbl?.selectFilters }}</h2>
    <button mat-mini-fab color="warn" class="ml-auto" aria-label="close dialog" (click)=" closeDialog()"
      mat-dialog-close><mat-icon>close</mat-icon></button>
  </div>
  <!--/Header-->
  <!--content-->
  <mat-dialog-content align="left">
    <app-filter [filterType]="filterType" [resetFilters]="resetFilters" [hideElements]="hideElements"
      [selectedFilter]="selectedFilters" [filters]="filters" (filterChanged)="filterChanged($event)"
      [chartData]="getChartData()" [telemetryInteractObject]="telemetryInteractObject">
    </app-filter>

  </mat-dialog-content>
  <!--/content-->

  <!--Actions-->
  <mat-dialog-actions align="center" class="mb-0">
    <button (click)="resetForm()" mat-raised-button color="accent" class="button-rounded" tabindex="0">
      {{resourceService?.frmelmnts?.btn?.reset}} {{resourceService?.frmelmnts?.lbl?.filters }}
    </button>
  </mat-dialog-actions>
  <!--/Actions-->
</ng-template>