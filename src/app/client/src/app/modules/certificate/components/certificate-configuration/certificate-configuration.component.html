<div class="mat-inside-page-container mat-app-background2">
  <!-- Loader -->
  <div class="w-100" *ngIf="showLoader">
    <app-loader></app-loader>
  </div>
  <!-- /Loader-->
  <div *ngIf="!showLoader">

    <!-- Header -->
    <div class="d-flex flex-ai-center header br-24 p-16">
      <button id="goBack" mat-mini-fab color="accent" class="button-rounded mr-8" type="button" tabindex="0"
        (click)="goBack()">
        <mat-icon fontIcon="arrow_back"></mat-icon>
        <!-- {{resourceService?.frmelmnts?.btn?.back}} -->
      </button>
      <!-- Textbook image -->
      <div class="bookimg">
        <img src="{{courseDetails?.appIcon}}" alt="textbook">
      </div>
      <div class="ml-8 heading">
        <!-- Textbook title -->
        <h4 class="color-accent font-weight-bold mb-0 mat-title" tabindex="0">{{courseDetails?.name}}
        </h4>
        <p class="mat-body-1 pt-8 mb-0">{{courseDetails?.contentType}}</p>
      </div>
    </div>
    <!-- / Header-->

    <!-- first screen -->
    <div class="sb-g mt-24" *ngIf="currentState === screenStates.default">
      <div class="sb-g-col-xs-12 sb-g-col-md-4 sb-g-col-lg-4 sb-g-col-xxxl-4">
        <div class="certificate-sidebar p-24 header br-24">
          <h2 class="mat-title pb-24 font-weight-bold text-left">
            {{resourceService?.frmelmnts?.cert?.lbl?.configure}}</h2>

          <div class="d-flex flex-ai-center flex-jc-space-between cert-sidebar-menu p-16 mb-16 mat-bg-white">
            <h6 class="mat-caption sb__ellipsis sb__ellipsis--three mb-0">{{courseDetails?.name}}
            </h6>
            <div class="d-flex flex-ai-center">
              <div class="certificate-card-img px-16">
                <img src="assets/images/certificate-icon.png" width="25px" height="20px" alt="certificate-icon" />
              </div>
              <div class="border-right"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="sb-g-col-xs-12 sb-g-col-md-8 sb-g-col-lg-8 sb-g-col-xxxl-8">
        <div *ngIf="!selectedTemplate" class="p-24">
          <div class="d-flex flex-dc flex-ai-center text-center mt-32">
            <div><img src="../../assets/images/addcertificate.png" alt="add certificate "></div>
            <p class="no-template-text pt-16 pb-24 px-40 mb-0">{{resourceService?.frmelmnts?.cert?.lbl?.noCertificate}}
              <b>{{resourceService?.frmelmnts?.cert?.lbl?.addCert }}</b>
              {{ resourceService?.frmelmnts?.cert?.lbl?.button}}
            </p>
            <button type="button" id="addNewCert" tabindex="0" (click)="certificateCreation()"
              class="button-rounded color-accent" mat-raised-button>
              {{resourceService?.frmelmnts?.cert?.lbl?.addCert }}
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </div>
        <div *ngIf="selectedTemplate" class="edit-certificate p-24 mat-bg-white">
          <h2 class="mat-tile font-weight-bold text-left">
            {{resourceService?.frmelmnts?.cert?.lbl?.certificate}}</h2>
          <div class="edit-certificate-img">
            <div class="certificate-frame">
              <div *ngIf="certEditable"><img class="img" src="{{previewUrl}}" alt="certificate edit"></div>
              <div *ngIf="!certEditable"
                class="d-flex flex-jc-center flex-dc p-24 mat-body-1 text-center color-warn w-100">
                <h3>{{resourceService?.frmelmnts?.cert?.lbl?.noEditAction}}</h3>
              </div>
            </div>
            <div class="d-flex flex-ai-center mt-16">
              <button type="button" [disabled]="!certEditable" (click)="editCertificate()" tabindex="0"
                class="button-rounded ml-auto" color="accent"
                mat-raised-button>{{resourceService?.frmelmnts?.lbl?.edit}}</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- second screen -->
    <div class="py-16" *ngIf="currentState === screenStates.certRules">

      <div class="sb-g">
        <div class="sb-g-col-xs-12 sb-g-col-md-8 sb-g-col-lg-8 sb-g-col-xxxl-12 mat-app-background br-24">
          <div class="w-100 p-24">
            <form [formGroup]="userPreference">

              <h2 *ngIf="configurationMode === 'add'" class="font-weight-bold mb-24">
                {{resourceService?.frmelmnts?.cert?.lbl?.addCert}}</h2>
              <h2 *ngIf="configurationMode === 'edit'" class="font-weight-bold mb-24">
                {{resourceService?.frmelmnts?.cert?.lbl?.editCert}}</h2>

              <div>
                <h3 class="font-weight-bold">
                  {{resourceService?.frmelmnts?.cert?.lbl?.certRules}}</h3>
                <div class="d-flex flex-dc w-50">
                  <mat-form-field appearance="fill" class="w-100">
                    <mat-label>{{resourceService?.frmelmnts?.cert?.lbl?.issueTo}}</mat-label>
                    <mat-select formControlName="issueTo" role="listbox"
                      aria-label="resourceService?.frmelmnts?.cert?.lbl?.issueTo" class="selection"
                      [disabled]="configurationMode === 'edit'" (selectionChange)="handleParameterChange($event)">
                      <mat-option role="option" *ngFor="let option of issueTo" [value]="option.name"
                        attr.aria-label="{{option.name}}">{{option.name}}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <label class="font-weight-normal text-left"
                  *ngIf="!isStateCertificate">{{resourceService?.frmelmnts?.intxt?.ssousers |
                  interpolate:'{instance}': instance}}</label>
              </div>

              <mat-divider class="mb-24"></mat-divider>

              <div class="d-flex mat-bg-white px-16 flex-ai-center br-24">
                <label
                  class="mat-body-1 font-weight-normal mb-0">{{resourceService?.frmelmnts?.lbl?.addCertificateprogressrule}}</label>
                <div class="mx-16"><mat-divider class="vertical-divider" [vertical]="true"></mat-divider></div>
                <div class="py-16 d-flex flex-dc flex-wrap">
                  <mat-form-field>
                    <input matInput type="text" placeholder="" value="100%" readonly=true color="accent">
                  </mat-form-field>
                  <p class="font-weight-normal mat-caption mb-0">
                    <span class="color-warn">*</span>
                    {{resourceService?.frmelmnts?.lbl?.addCertificateText}}
                  </p>
                </div>
              </div>


              <div class="progess-add-content" *ngIf="isSingleAssessment">
                <div class="left-border"></div>
                <button type="button" mat-raised-button class="button-rounded color-warn font-weight-bold"
                  *ngIf="addScoreRule">AND</button>
                <button type="button" mat-mini-fab class="color-accent" *ngIf="!addScoreRule" tabindex="0"
                  (click)="addRule()"><mat-icon>add</mat-icon></button>
                <div class="left-border" *ngIf="addScoreRule"></div>
              </div>

              <div class="d-flex mat-bg-white px-16 br-24 flex-ai-center add-score"
                *ngIf="addScoreRule && isSingleAssessment">
                <label
                  class="font-weight-normal mb-0 mat-body-1">{{resourceService?.frmelmnts?.lbl?.addCertificatescorerule}}</label>
                <div class="mx-16"><mat-divider class="vertical-divider" [vertical]="true"></mat-divider></div>
                <div class="d-flex flex-dc w-100">
                  <div class="d-flex flex-ai-center flex-jc-space-around">
                    <mat-form-field>
                      <input matInput type="text" placeholder="Best attempt score"
                        value="{{resourceService?.frmelmnts?.lbl?.bestScoreattempt}}" readonly="true">
                    </mat-form-field>
                    <div class="w-15">{{resourceService?.frmelmnts?.lbl?.addCertificategreaterThan}}</div>
                    <sui-select class="selection form-control" [placeholder]="'Select'" formControlName="scoreRange"
                      [options]="scoreRange" #selectScoreRange>
                      <sui-select-option *ngFor="let option of arrayValue['range']" [value]="option + '%'">
                      </sui-select-option>
                    </sui-select>
                  </div>
                  <p class="font-weight-normal mat-caption mb-0 completion-text">
                    <span class="color-warn">*</span>
                    {{resourceService?.frmelmnts?.lbl?.addCertificateText}}
                  </p>
                </div>
                <button type="button" mat-mini-fab color="warn" class="close-score" tabindex="0"
                  (click)="removeRule()"><mat-icon>close</mat-icon></button>
              </div>

              <div class="mt-24 w-100">
                <mat-checkbox class="mr-8 cursor-pointer" formControlName="allowPermission" value="true" type="checkbox"
                  id="check2" name="selected">{{resourceService?.frmelmnts?.cert?.lbl?.verified}}</mat-checkbox>
              </div>
            </form>
          </div>

          <div class="d-flex flex-dc p-16" *ngIf="selectedTemplate">
            <img src="{{selectedTemplate?.artifactUrl || selectedTemplate?.previewUrl}}" alt="certificate edit">
            <button type="button" (click)="removeSelectedCertificate()" tabindex="0" mat-raised-button color="accent"
              class="button-rounded ml-auto mt-16">{{resourceService?.frmelmnts?.btn?.remove}}</button>
          </div>

        </div>
        <!-- Side panel of cert-templates -->
        <div class="sb-g-col-xs-12 sb-g-col-md-4 sb-g-col-lg-4 sb-g-col-xxxl-4">
          <div class="select-template-content mat-app-background p-24 br-24">
            <div class="select-template-container mb-16">
              <div class="d-flex flex-ai-center text-left flex-jc-space-between">
                <label
                  class="mat-title font-weight-bold mb-0">{{resourceService?.frmelmnts?.cert?.lbl?.templates}}</label>
                <button mat-raised-button class="button-rounded color-accent" type="button"
                  (click)="navigateToCreateTemplate()" tabindex="0">
                  <mat-icon>add</mat-icon>{{resourceService?.frmelmnts?.cert?.btn?.createtemp}}</button>
              </div>
              <div class="d-flex flex-ai-center text-left flex-jc-space-between my-16">
                <label
                  class="font-weight-normal mat-body-1 font-weight-bold mb-0">{{resourceService?.frmelmnts?.cert?.lbl?.certNote}}</label>
                <button (click)="refreshData()" mat-raised-button class="button-rounded color-accent" tabindex="0">
                  {{resourceService?.frmelmnts?.cert?.btn?.refresh}}
                </button>
              </div>
              <div *ngIf="certTemplateList" class="certificate-scrollbar">
                <div *ngFor="let template of certTemplateList">
                  <sb-certificate-actions [preview]="config?.preview"
                    [isSelectedTemplate]="selectedTemplate?.identifier === template?.identifier && !showPreviewModal"
                    [template]="template?.artifactUrl" (buttonClick)="handleCertificateEvent($event, template)">
                  </sb-certificate-actions>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex flex-ai-center flex-jc-flex-end mat-bg-white p-24 mt-24 br-24"
        *ngIf="currentState === screenStates.certRules">
        <button mat-raised-button class="button-rounded mr-8 color-accent" tabindex="0"
          (click)="cancelSelection()">{{resourceService?.frmelmnts?.btn?.cancel}}</button>
        <button *ngIf="configurationMode === 'add'" [disabled]="disableAddCertificate" tabindex="0" mat-raised-button
          color="accent" class="button-rounded ml-8 px-24"
          (click)="attachCertificateToBatch()">{{resourceService?.frmelmnts?.cert?.lbl?.addCert}}</button>
        <button id="update-certificate" *ngIf="configurationMode === 'edit'" [disabled]="disableAddCertificate"
          mat-raised-button color="accent" class="button-rounded ml-8 px-24" tabindex="0"
          (click)="updateCertificate()">{{resourceService?.frmelmnts?.cert?.lbl?.updateCert}}</button>
      </div>

    </div>

  </div>

</div>


<app-cert-preview-popup *ngIf="showPreviewModal" (close)="closeModal($event)" [template]="previewTemplate">
</app-cert-preview-popup>

<!-- footer certificate -->
<app-modal-wrapper *ngIf="isTemplateChanged"
  [config]="{disableClose: true, size: 'normal', width: '45rem', panelClass: 'material-modal'}"
  (dismiss)="closeTemplateDetectModal()" #templateChangeModal>
  <ng-template sbModalContent>

    <div mat-dialog-title class="mb-0">
      <h2 class="mb-0">{{resourceService?.frmelmnts?.cert?.lbl?.changeDetected}}</h2>
    </div>

    <mat-dialog-content>
      <div class="sb-g">
        <div class="sb-g-col-xs-2 sb-g-col-md-2 sb-g-col-lg-2 sb-g-col-xxxl-2">
          <div class="checkbox-img"></div>
        </div>
        <div class="sb-g-col-xs-10 sb-g-col-md-10 sb-g-col-lg-10 sb-g-col-xxxl-10">
          <p class="mat-body-1">{{resourceService?.frmelmnts?.cert?.lbl?.templateChange}}</p>
        </div>
      </div>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
      <button (click)="closeTemplateDetectModal()" tabindex="0" mat-raised-button class="button-rounded mr-8">
        {{resourceService?.frmelmnts?.btn?.cancel}}
      </button>
      <button (click)="attachCertificateToBatch()" tabindex="0" mat-raised-button color="accent" class="button-rounded">
        {{resourceService?.frmelmnts?.lbl?.continue}}
      </button>
    </mat-dialog-actions>

  </ng-template>
</app-modal-wrapper>

<app-modal-wrapper *ngIf="showAlertModal"
  [config]="{disableClose: true, size: 'small', width: '30rem', panelClass: 'material-modal'}"
  (dismiss)="showAlertModal = false" #modal>
  <ng-template sbModalContent>

    <div mat-dialog-title class="mb-0">
      <h2 class="mb-0">{{resourceService?.frmelmnts?.cert?.lbl?.alertHeader}}</h2>
      <button mat-mini-fab color="warn" class="ml-auto" aria-label="close dialog"
        mat-dialog-close><mat-icon>close</mat-icon></button>
    </div>

    <mat-dialog-content class="text-center">
      <p>{{resourceService?.frmelmnts?.cert?.imsg?.alertMessageForCert}}</p>
    </mat-dialog-content>

  </ng-template>
</app-modal-wrapper>