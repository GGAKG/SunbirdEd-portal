<!-- Join Course Table -->
<app-modal-wrapper [config]="{disableClose: true, width: '45rem', panelClass: 'material-modal'}" (dismiss)="showJoinModal = !showJoinModal;" *ngIf="showJoinModal">
  <ng-template sbModalContent let-data>
    <div mat-dialog-title class="mb-0">
      <h4 class="color-accent font-weight-bold mb-0">{{resourceService?.frmelmnts?.lbl?.selectBatch}}</h4>
      <button mat-mini-fab color="warn" class="ml-auto" aria-label="close dialog"
        mat-dialog-close><mat-icon>close</mat-icon></button>
    </div>
    <mat-dialog-content class="batch-details-component">
      <div *ngIf="showAllBatchList">
        <div class="join-batch">
          <div class="join-batch__heading">
            <div class="mat-body-2">{{resourceService?.frmelmnts?.lbl?.availableBatches}}</div>
            <div class="mat-body-2">{{resourceService?.frmelmnts?.lbl?.courseCreatedBy}}</div>
          </div>
          <div class="join-batch__body" *ngFor="let batch of allBatchList">
            <div class="mat-body-2">{{batch.startDate | dateFormat}}<span *ngIf="batch.endDate"> - {{batch.endDate | dateFormat}}
              </span></div>
            <div class="mat-body-2" *ngIf="userNames[batch.createdBy]">{{userNames[batch.createdBy].firstName}}
              {{userNames[batch.createdBy].lastName}}</div>
            <button mat-raised-button color="accent" class="button-rounded" tabindex="0"
              (click)="enrollBatch(batch); logTelemetry('enroll-batch', courseHierarchy, batch?.identifier)">{{resourceService?.frmelmnts?.lbl?.join}}</button>
          </div>
        </div>
      </div>
      <div *ngIf="showAllBatchError">
        <div class="color-warn px-16 py-8 mat-body-2">{{resourceService.messages.stmsg.m0081}}</div>
      </div>
    </mat-dialog-content>
  </ng-template>
</app-modal-wrapper>

<!-- create batch -->
<mat-accordion class="view-batch-trackable" *ngIf="isTrackable && viewBatch">
  <mat-expansion-panel [expanded]="true" class="mat-app-background">
    <mat-expansion-panel-header tabindex="0" attr.aria-label="{{resourceService?.frmelmnts?.lbl?.batches}} accordion"
      aria-controls="batches">
      <mat-panel-title class="mat-subheading-1 mb-0">
        {{resourceService?.frmelmnts?.lbl?.batches}}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div role="region" id="batches" aria-labelledby="batches">
        <div class="mb-16" *ngIf="showBatchList">
            
            <mat-form-field appearance="fill" class="w-100" color="accent">
              <mat-label>{{resourceService.frmelmnts?.lbl?.batchStatus}}</mat-label>
              <mat-select role="listbox" aria-label="Select Status" [(value)]="selectedLanguage" class="selection"
                [(ngModel)]="batchStatus" (selectionChange)="getSelectedBatches()">
                <mat-option role="option" *ngFor="let option of statusOptions" [value]="option.value"
                  attr.aria-label="{{option.name}}">{{option.name}}</mat-option>
              </mat-select>
            </mat-form-field>
            
            <div *ngFor="let batch of batchList">
              <div class="mat-body-1 color-accent mb-8 d-flex flex-w-wrap flex-ai-center flex-w-wrap"><mat-icon aria-hidden="false" aria-label="Calender"
                  fontIcon="calendar_month"></mat-icon> {{batch.startDate | dateFormat}} <span *ngIf="batch.endDate"> - {{batch.endDate | dateFormat}} </span>
              </div>
              <div class="batch-details__edit d-flex flex-ai-center">
                <div *ngIf="allowBatchCreation && allowCertCreation">
                    <a href="javascript:void(0)" mat-button *ngIf="!isCertAdded(batch)" color="accent" tabindex="0"
                      (click)="navigateToConfigureCertificate('add', batch?.identifier); logTelemetry('add-certificate')">{{resourceService?.frmelmnts?.cert?.lbl?.addCert}}</a>
                    <a href="javascript:void(0)" mat-button *ngIf="isCertAdded(batch)" color="accent" tabindex="0"
                      (click)="navigateToConfigureCertificate('edit', batch?.identifier); logTelemetry('edit-certificate')">{{resourceService?.frmelmnts?.cert?.lbl?.editCert}}</a>
                </div>
                <button mat-raised-button class="ml-auto button-rounded" tabindex="0"
                  (click)="batchUpdate(batch); logTelemetry('update-batch', courseHierarchy, batch?.identifier);"
                  [disabled]="(!isExpiredBatchEditable && batch.status === 2)">
                  {{resourceService?.frmelmnts?.lbl?.edit}}
                </button>
              </div>

              <p class="mat-caption mt-8" *ngIf="userNames[batch.createdBy]">
                {{resourceService?.frmelmnts?.lbl?.courseCreatedBy}}
                {{userNames[batch.createdBy].firstName}} {{userNames[batch.createdBy].lastName}}
              </p>
              <div class="mt-8 mat-caption"
                *ngIf="isValidEnrollmentEndDate(batch.enrollmentEndDate)">
                <span class="mat-caption"
                  *ngIf="!isEnrollmentAllowed(batch.enrollmentEndDate)">{{resourceService.messages.stmsg.m0136}}
                  {{batch.enrollmentEndDate | dateFormat}}</span>
                <span class="color-warn"
                  *ngIf="isEnrollmentAllowed(batch.enrollmentEndDate)">{{resourceService.messages.stmsg.m0134}}</span>
              </div>
            </div>
            <div class="bgcolor-error px-16 py-8 mat-body-2 br-4" *ngIf="batchList.length <= 0">{{resourceService.messages.stmsg.m0081}}</div>
        </div>
     <div *ngIf="showError" class="bgcolor-error px-16 py-8 mat-body-2 br-4">{{resourceService.messages.stmsg.m0081}}</div>
    
     <button mat-raised-button color="accent" class="width-100 button-rounded" tabindex="0"
     (click)="createBatch(); logTelemetry('create-batch', courseHierarchy);"
     *ngIf="allowBatchCreation && isTrackable && showCreateBatchBtn">{{resourceService.frmelmnts.lbl.createbatch}}</button>
      </div>
  </mat-expansion-panel>
</mat-accordion>

<!-- batch details -->
<mat-accordion class="show-batch-details" *ngIf="showBatchDetailsBeforeJoin">
  <mat-expansion-panel [expanded]="true" class="mat-app-background">
    <mat-expansion-panel-header>
      <mat-panel-title class="mat-subheading-1 mb-0">
        {{resourceService?.frmelmnts?.lbl?.batchdetails}}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="mb-16">
      <div *ngIf="batchDetails?.startDate">
        <div class="mat-caption color-accent">
          {{resourceService?.frmelmnts?.lbl?.coursebatchstartdate}}</div>
        <div class="mat-body-1">{{batchDetails?.startDate | dateFormat}}
        </div>
      </div>
      <mat-divider class="my-8" *ngIf="batchDetails?.endDate"></mat-divider>
      <div *ngIf="batchDetails?.endDate">
        <div class="mat-caption color-accent">
          {{resourceService?.frmelmnts?.lbl?.coursebatchenddate}}</div>
        <div class="mat-body-1">{{batchDetails?.endDate | dateFormat}}</div>
      </div>
      <mat-divider class="my-8" *ngIf="isValidEnrollmentEndDate(batchDetails?.enrollmentEndDate)"></mat-divider>
      <div *ngIf="isValidEnrollmentEndDate(batchDetails?.enrollmentEndDate)">
        <div class="mat-caption color-accent">
          {{resourceService?.frmelmnts?.lbl?.enrollmentenddate}}</div>
        <div class="mat-body-1"> {{batchDetails?.enrollmentEndDate |
          dateFormat}}</div>
        <div class="color-warn" *ngIf="isEnrollmentAllowed(batchDetails?.enrollmentEndDate)">
          {{resourceService?.messages?.emsg?.m008 | interpolate:'{endDate}':batchDetails?.enrollmentEndDate}}</div>
      </div>
    </div>
  </mat-expansion-panel>
</mat-accordion>
<mat-accordion class="show-certificate-details" *ngIf="showCertificateDetails" class="">
  <mat-expansion-panel class="mat-app-background">
    <mat-expansion-panel-header title class="">
      <mat-panel-title class="mat-subheading-1 mb-0">
        <span>{{resourceService?.frmelemnts?.scttl?.certques}}</span>
      </mat-panel-title>
    </mat-expansion-panel-header>
    <ul class="mb-16">
      <li class="mat-caption" *ngIf="showCompletionCertificate">
        {{resourceService?.frmelmnts?.bltpt?.earnyourcert}}</li>
      <li class="mat-caption" *ngIf="showMeritCertificate">
        {{resourceService?.frmelemnts?.bltpt?.earnmcert |
        interpolate:'{percent}': meritCertPercent}}</li>
    </ul>
  </mat-expansion-panel>
</mat-accordion>

<!-- Leave batch card -->
<mat-accordion class="leave-batch-card" *ngIf="enrolledCourse && enrolledBatchInfo && !viewBatch">
  <mat-expansion-panel [expanded]="true" class="mat-app-background">
    <mat-expansion-panel-header>
      <mat-panel-title class="mat-subheading-1 mb-0">
        {{resourceService.frmelmnts.lbl.batchdetails}}
      </mat-panel-title>
    </mat-expansion-panel-header>
      <div class="d-flex flex-dc">
        <div class="mb-16">
          <div class="mat-subheading-2 color-accent">
            {{enrolledBatchInfo?.name}}</div>
          <div class="mt-8 mat-caption">
            <span class="date">{{enrolledBatchInfo.startDate | dateFormat}} </span>
            <span *ngIf="enrolledBatchInfo.endDate" class="date"> -
              {{enrolledBatchInfo?.endDate | dateFormat}}</span>
          </div>
        </div>
        <button
            mat-stroked-button color="accent" class="button-rounded" tabindex="0"
            (click)="unenrollBatch(enrolledBatchInfo); logTelemetry('unenroll-batch', courseHierarchy);"
            [disabled]="isUnenrollbtnDisabled">{{generaliseLabelService?.frmelmnts?.btn?.unenroll}}</button>
        <div class="mt-8 mat-caption">
          <span *ngIf="enrolledBatchInfo?.participantCount>=0">
            {{enrolledBatchInfo?.participantCount}} {{resourceService.frmelmnts.lbl.learners}}
          </span>
          <span>
            {{enrolledBatchInfo?.mentors?.length}} {{resourceService.frmelmnts.lbl.mentors}}
          </span>
        </div>
      </div>
  </mat-expansion-panel>
</mat-accordion>

<app-modal-wrapper [config]="{disableClose: true, width: '30rem', panelClass: 'material-modal', size: 'small'}"
  (dismiss)="showMessageModal = false;" *ngIf="showMessageModal">
  <ng-template sbModalContent>

    <!--/Header-->
    <div mat-dialog-title class="mb-0">
      <h4 class="color-accent font-weight-bold mb-0">{{generaliseLabelService?.frmelmnts?.btn?.enroll}}</h4>
      <button mat-mini-fab color="warn" class="ml-auto" aria-label="close dialog"
        mat-dialog-close><mat-icon>close</mat-icon></button>
    </div>

    <!--Content-->
    <mat-dialog-content class="d-flex flex-ai-center flex-jc-center">
      <p class="mat-body-2">{{batchMessage}}</p>
    </mat-dialog-content>

  </ng-template>
</app-modal-wrapper>