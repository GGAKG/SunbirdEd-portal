<mat-toolbar color="primary" class="toolbar-pageback">
  <div class="d-flex flex-ai-center w-below-sm-100 w-above-sm-60">
    <button type="button" mat-mini-fab color="accent" class="button-rounded" tabindex="0"
      (click)="goBack(); logTelemetry('back-track', courseHierarchy)"
      attr.aria-label="{{resourceService?.frmelmnts?.btn?.back}}">
      <mat-icon aria-hidden="false" fontIcon="arrow_back"></mat-icon>
    </button>
    <div class="toolbar-pageback__heading">
      <h3 class="mat-title mb-4 sb__ellipsis" tabindex="0" role="heading" aria-level="2">{{courseHierarchy?.name |
        titlecase}}</h3>
    </div>
  </div>
  <div class="toolbar-pageback__actions">
    <button tabindex="0" mat-raised-button color="accent" (click)="onShareLink();shareLinkModal=true;"
      class="button-rounded"><mat-icon>share</mat-icon>
      {{resourceService?.frmelmnts?.lbl?.share}}
    </button>
  </div>
</mat-toolbar>

<div *ngIf="!showLoader" [appTelemetryImpression]="telemetryPlayerPageImpression"
  class="mat-inside-page-container mat-app-background2 assessment-player-component">
  <div class="sb-g">
    <section class="sb-g-col-xs-12 sb-g-col-md-8 sb-g-col-lg-8 sb-g-col-xxxl-12">
          <section id="player-area-height" class="mb-8">
            <div class="aspectratio" data-ratio="16:9" id="help-video-aspect-ratio" #aspectRatio>
              <app-player *ngIf="showPlayer" class="content-player" [playerOption]="playerOption"
                [playerConfig]="playerConfig" [contentProgressEvents$]="contentProgressEvents$"
                (assessmentEvents)="onAssessmentEvents($event)"
                (questionScoreSubmitEvents)="onQuestionScoreSubmitEvents($event)"
                (questionScoreReviewEvents)="onQuestionScoreReviewEvents($event)"
                (ratingPopupClose)="onRatingPopupClose()"
                (selfAssessLastAttempt)="onSelfAssessLastAttempt($event)"></app-player>
            </div>
            <app-content-actions [assessmentEvents]="assessmentEvents" *ngIf="isFullScreenView"
              class="player-fullscreen-action-items" [isFullScreen]="true" [contentData]="activeContent"
              [objectRollUp]="objectRollUp">
            </app-content-actions>
            <app-content-actions [assessmentEvents]="assessmentEvents" *ngIf="activeContent"
              [contentData]="activeContent" [objectRollUp]="objectRollUp">
            </app-content-actions>
          </section>
          <app-credits-and-licence *ngIf="activeContent" [contentData]="activeContent"></app-credits-and-licence>
    </section>
    <section class="sb-g-col-xs-12 sb-g-col-md-4 sb-g-col-lg-4 sb-g-col-xxxl-4">
        <!-- Module Progress bar -->
        <div class="certified-course__progress" *ngIf="totalContents > 0">
          <!-- Previous / next module buttons -->
          <div class="d-flex flex-ai-center flex-jc-space-between mb-16">
            <!-- Previous module button -->
            <button mat-button color="accent" class="button-rounded" aria-label="previous-module" *ngIf="prevModule"
              tabindex="0"
              (click)="navigateToPlayerPage(prevModule); logTelemetry('previous-module', prevModule, true);">
              <mat-icon>chevron_left</mat-icon> {{generaliseLabelService?.frmelmnts?.lbl?.prevModule | translate}}
            </button>
            <!-- Previous Module button -->
            <!-- Next Module button -->
            <button mat-button color="accent" class="button-rounded" aria-label="next-module" *ngIf="nextModule"
              tabindex="0" (click)="navigateToPlayerPage(nextModule); logTelemetry('next-module', nextModule, true)">
              {{generaliseLabelService?.frmelmnts?.lbl?.nextModule | translate}}
              <mat-icon>chevron_right</mat-icon>
            </button>
            <!-- Next Module button -->
          </div>
          <div *ngIf="!isUnitCompleted" class="mat-bg-white p-16 text-left">
            <div class="mat-body-2">{{generaliseLabelService?.frmelmnts?.lbl?.moduleProgress}}</div>
            <div class="color-accent mat-body-1 font-weight-bold mt-4">{{consumedContents}}/{{totalContents}}
              {{resourceService?.frmelmnts?.lbl?.completed}}</div>
            <mat-progress-bar color="accent" mode="determinate" [value]="consumedContents"
              class="mb-0 mr-0 mt-8"></mat-progress-bar>
          </div>

          <div class="module-complete-content d-flex flex-ai-center py-8 px-16 mb-8" *ngIf="isUnitCompleted">
            <div class="mr-16 complete-content-image"><img src="./assets/images/badge-complete.svg"
                alt="complete-content-image"></div>
            <label
              class="font-weight-bold mb-0 mat-body-1 color-success">{{generaliseLabelService?.frmelmnts?.lbl?.moduleFinish}}</label>
          </div>
        </div>


        <h5 class="mat-subheading-2 p-16 mb-0 font-weight-bold text-left">{{resourceService?.frmelmnts?.lbl?.contentsLabel}}</h5>
        <div class="mat-app-background p-16 br-24">
          <div *ngFor="let item of courseHierarchy?.children; let index = index;" class="mat-bg-white list-container">
            <p *ngIf="item?.mimeType === 'application/vnd.ekstep.content-collection'" class="mat-body-2">{{item?.name}}</p>
            <div *ngIf="item;else noContent">
              <div *ngIf="item?.mimeType !== 'application/vnd.ekstep.content-collection' && !item?.children?.length">
                <ng-container *ngIf="item?.contentType">
                    <!-- toc card for Non Self Assess content -->
                    <sb-toc-card *ngIf="item?.contentType !== 'SelfAssess'" [content]="item"
                      (tocCardClick)="navigateToInitPlayer($event, 'toc-card')" [type]="cardType"
                      [contentStatus]="contentStatus">
                    </sb-toc-card>
                    <!-- toc card for Self Assess content with Label for Best Score -->
                    <sb-toc-card *ngIf="item?.contentType === 'SelfAssess'" [content]="item"
                      (tocCardClick)="navigateToInitPlayer($event, 'toc-card')" [type]="cardType"
                      [contentStatus]="contentStatus" [maxAttempts]="item?.maxAttempts" [scoreLabel]="'Best Score'"
                      [disabled]="'disabled-toc-card'">
                    </sb-toc-card>
                </ng-container>
              </div>

              <div *ngIf="item?.mimeType === 'application/vnd.sunbird.questionset'">
                  <sb-toc-card [content]="item" (tocCardClick)="navigateToInitPlayer($event, 'toc-card')"
                    [type]="cardType" [contentStatus]="contentStatus" [maxAttempts]="item?.maxAttempts"
                    [scoreLabel]="'Best Score'" [disabled]="'disabled-toc-card'">
                  </sb-toc-card>
              </div>

              <div *ngIf="item?.children?.length">
                <div *ngFor="let child of item?.children">
                  <div *ngIf="child?.mimeType !== 'application/vnd.sunbird.question'">
                    <sb-toc-child-item [activeContent]="activeContent" [childData]="child"
                      (tocCardClick)="navigateToInitPlayer($event, 'child-item')" [contentStatus]="contentStatus"
                      [type]="cardType">
                    </sb-toc-child-item>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noContent>
              <div class="heading">{{noContentMessage}}</div>
            </ng-template>
          </div>
          <sb-toc-card [content]="courseHierarchy"
            *ngIf="courseHierarchy?.mimeType !== 'application/vnd.ekstep.content-collection'"
            (tocCardClick)="navigateToInitPlayer($event)" [type]="cardType" [contentStatus]="contentStatus">
          </sb-toc-card>
        </div>
    </section>
  </div>
    <app-loader *ngIf="showLoader" [data]='loaderMessage'></app-loader>
</div>

<app-modal-wrapper *ngIf="shareLinkModal" [config]="{disableClose: false, panelClass: 'material-modal'}"
  (dismiss)="shareLinkModal = false">
  <ng-template sbModalContent>
    <app-share-link [shareLink]="shareLink" [telemetryShareData]="telemetryShareData">
    </app-share-link>
  </ng-template>
</app-modal-wrapper>

<app-course-completion *ngIf="showCourseCompleteMessage" [certificateDescription]="certificateDescription"
  (close)="onCourseCompleteClose()"></app-course-completion>

<!-- Start - Modal for Assessment attempts -->
<app-modal-wrapper *ngIf="showMaxAttemptsModal" [config]="{disableClose: true, width: '30rem', size: 'normal'}"
  (dismiss)="closeLoginModal()" #modal>
  <ng-template sbModalContent>
    <mat-dialog-content>
      <h4 class="font-weight-bold mb-0 py-16">
        {{resourceService?.frmelmnts?.lbl?.selfAssessMaxAttempt}}
      </h4>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
      <button appTelemetryInteract [telemetryInteractObject]="telemetryInteractObject" tabindex="0"
        [telemetryInteractEdata]="signInInteractEdata" (click)="goBack(); showMaxAttemptsModal = !showMaxAttemptsModal"
        mat-raised-button color="warn" class="button-rounded">
        {{resourceService?.frmelmnts?.btn?.close}}
      </button>
    </mat-dialog-actions>

  </ng-template>
</app-modal-wrapper>
<!-- End - Modal for Assessment attempts -->

<!-- Start - Modal for Assessment attempts -->
<app-modal-wrapper *ngIf="showLastAttemptsModal" [config]="{disableClose: true, width: '30rem', size: 'small'}" #modal>
  <ng-template sbModalContent>

    <mat-dialog-content>
      <h4 class="font-weight-bold mb-0 py-16">
        {{resourceService?.frmelmnts?.lbl?.selfAssessLastAttempt}}
      </h4>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-raised-button class="button-rounded" tabindex="0" (click)="showLastAttemptsModal = false;">
        {{resourceService.frmelmnts?.btn?.cancel}}
      </button>
      <button mat-raised-button color="accent" class="button-rounded mr-8" tabindex="0"
        (click)="showLastAttemptsModal = false; onTocCardClick();">
        {{resourceService.frmelmnts?.btn?.ok}}
      </button>
    </mat-dialog-actions>

  </ng-template>
</app-modal-wrapper>
<!-- End - Modal for Assessment attempts -->

<!--Rating popup -->
<app-content-rating *ngIf="contentRatingModal && playerConfig" [contentData]="playerConfig.metadata"
  (closeModal)="onRatingPopupClose()"></app-content-rating>